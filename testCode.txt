# Code complet pour d√©tecter uniquement les t√©l√©phones dans un dossier d‚Äôimages avec YOLOv8 pr√©-entra√Æn√© (√† utiliser dans Google Colab)

# 1. Monter Google Drive (si tes images sont sur Drive)
from google.colab import drive
drive.mount('/content/drive')

# 2. Installer Ultralytics (YOLOv8)
!pip install -q ultralytics

# 3. Importer les librairies n√©cessaires
from ultralytics import YOLO
import cv2
import os
from matplotlib import pyplot as plt

# 4. D√©finir les chemins (√† adapter selon ton Google Drive)
image_folder = '/content/drive/MyDrive/Internship_S8_2025 2024/AI_Security/Demo/NewTest'
output_folder = '/content/drive/MyDrive/Internship_S8_2025 2024/AI_Security/Demo/NewTestRst'
os.makedirs(output_folder, exist_ok=True)

# 5. Charger le mod√®le YOLOv8 pr√©-entra√Æn√© sur COCO
model = YOLO('yolov8n.pt')  # Tu peux remplacer par 'yolov8s.pt' ou 'yolov8m.pt' pour plus de pr√©cision

# 6. ID de la classe "cell phone" dans COCO
PHONE_CLASS_ID = 67

# 7. Parcourir les images et d√©tecter uniquement les t√©l√©phones
for image_name in os.listdir(image_folder):
    if image_name.lower().endswith(('.jpg', '.jpeg', '.png')):
        image_path = os.path.join(image_folder, image_name)
        results = model(image_path, conf=0.5)
        detections = results[0].boxes

        # Filtrer les d√©tections pour ne garder que les t√©l√©phones
        phone_boxes = [box for box in detections if int(box.cls[0]) == PHONE_CLASS_ID]

        if phone_boxes:
            print(f"üü• T√©l√©phone d√©tect√© dans : {image_name}")
            image = cv2.imread(image_path)
            for box in phone_boxes:
                x1, y1, x2, y2 = map(int, box.xyxy[0])
                conf = float(box.conf[0])
                label = model.names[PHONE_CLASS_ID]
                # Dessiner la bo√Æte et le label
                cv2.rectangle(image, (x1, y1), (x2, y2), (0, 0, 255), 2)
                cv2.putText(image, f'{label} {conf:.2f}', (x1, y1 - 10),
                            cv2.FONT_HERSHEY_SIMPLEX, 0.6, (0, 0, 255), 2)
            # Sauvegarder l'image annot√©e
            output_path = os.path.join(output_folder, image_name)
            cv2.imwrite(output_path, image)
            # Afficher l'image
            image_rgb = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)
            plt.figure(figsize=(10, 8))
            plt.imshow(image_rgb)
            plt.title(f"T√©l√©phone d√©tect√© : {image_name}")
            plt.axis('off')
            plt.show()
        else:
            print(f"‚úÖ Pas de t√©l√©phone d√©tect√© dans : {image_name}") 